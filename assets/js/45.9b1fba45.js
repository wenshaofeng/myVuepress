(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{308:function(s,t,e){"use strict";e.r(t);var a=e(28),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"性能工具-性能检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#性能工具-性能检测"}},[s._v("#")]),s._v(" 性能工具 - 性能检测")]),s._v(" "),e("h2",{attrs:{id:"http宏观性能检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http宏观性能检测"}},[s._v("#")]),s._v(" http宏观性能检测")]),s._v(" "),e("h3",{attrs:{id:"_1-压力测试工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-压力测试工具"}},[s._v("#")]),s._v(" 1. 压力测试工具")]),s._v(" "),e("ul",[e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("ab(Apache bench)")])],1),s._v(" "),e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("webbench")])],1)]),s._v(" "),e("p",[s._v("那我们这里使用的就是"),e("code",[s._v("ab")]),s._v("，我们要先到官网上去下载这个工具，这个工具的下载地址在"),e("a",{attrs:{href:"https://www.apachehaus.com/cgi-bin/download.plx",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.apachehaus.com/cgi-bin/download.plx"),e("OutboundLink")],1),s._v(",然后，你根据你自己的电脑的情况安装，我们这里是windowx64，我就点击下面那个下载压缩包")]),s._v(" "),e("img",{attrs:{src:s.$withBase("/node_bff_ab_download.png"),alt:"ab下载工具"}}),s._v(" "),e("p",[s._v("然后在解压后的"),e("code",[s._v("bin")]),s._v("目录打开命令行，输入测试命令就能开始测试了")]),s._v(" "),e("h3",{attrs:{id:"_2-压力测试过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-压力测试过程"}},[s._v("#")]),s._v(" 2. 压力测试过程")]),s._v(" "),e("p",[s._v("当我们启动我们的服务器在"),e("code",[s._v("127.0.0.1:3000")]),s._v("端口后我们在前面下载好的"),e("code",[s._v("ab")]),s._v("文件夹的"),e("code",[s._v("bin")]),s._v("目录下面打开命令行窗口，执行下面的压测命令")]),s._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("ab "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c200 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n1600 http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("-c")]),s._v(": 即concurrency，用于指定压力测试的并发数,模拟当前共有多少个客户端在进行同时请求")],1),s._v(" "),e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("-n")]),s._v("：即requests，用于指定压力测试总共的执行次数。")],1)]),s._v(" "),e("p",[s._v("测试结果如下：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("This is ApacheBench, Version "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Revision")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1843412")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCopyright "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1996")]),s._v(" Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("be patient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("320")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("480")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("640")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("800")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("960")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1120")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1280")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1440")]),s._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v(" requests\nFinished "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v(" requests\n\n\nServer Software:\nServer Hostname:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nServer Port:            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n\nDocument Path:          /download/                 // 访问包的路径\nDocument Length:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("264785")]),s._v(" bytes               // 访问包的大小（大概是259kb，你在浏览器上打开network面板看到Doc当中的siza也是259k）\n\nConcurrency Level:      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("                        // 你自己输入压测命令时的并发数\nTime taken "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" tests:   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.137")]),s._v(" seconds             // 压测一共花的时间\nComplete requests:      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v("                       // 成功完成的压测请求数（根据http返回码判断）\nFailed requests:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                          // 压测请求失败的数量\nTotal transferred:      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("423993600")]),s._v(" bytes            // "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v("次一共传输的总数据量\nHTML transferred:       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("423656000")]),s._v(" bytes            // "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v("次html一共传输的总数据量\nRequests per second:    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.80")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)      // (最重要qps) 平均每秒的请求数，也就是服务器能最大承受的每秒并发量")]),s._v("\nTime per request:       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1642.094")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       // （重要）200个用户每次请求所花平均时间 \nTime per request:       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.210")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" （最重要）单个用户请求一次的平均时间\nTransfer rate:          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31518.92")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received // "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("最重要"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 传输速率，或者吞吐量（有多少数据量的交互）\n\nConnection Times "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+/-sd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\nConnect:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("\nProcessing:   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1595")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("181.5")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1599")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2006")]),s._v("\nWaiting:       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("114")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("34.3")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("214")]),s._v("\nTotal:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1596")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("181.1")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2007")]),s._v("\n\nPercentage of the requests served within a certain "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1640")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1658")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1680")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1823")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1878")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1992")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2002")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2007")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("longest request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br")])]),e("h3",{attrs:{id:"_3-http服务的性能瓶颈猜测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-http服务的性能瓶颈猜测"}},[s._v("#")]),s._v(" 3. http服务的性能瓶颈猜测")]),s._v(" "),e("p",[s._v("通过上述的这种报告，我们基本能看到关于服务器性能最重要的四个参数："),e("font",{attrs:{color:"#1E90FF"}},[s._v("Requests per second")]),s._v("，"),e("font",{attrs:{color:"#1E90FF"}},[s._v("Time per request")]),s._v("，"),e("font",{attrs:{color:"#1E90FF"}},[s._v("Time per request")]),s._v("，"),e("font",{attrs:{color:"#1E90FF"}},[s._v("Transfer rate")])],1),s._v(" "),e("p",[s._v("服务器的性能当然有瓶颈的存在，一般瓶颈会被"),e("font",{attrs:{color:"#DD1144"}},[s._v("cpu")]),s._v("、"),e("font",{attrs:{color:"#DD1144"}},[s._v("硬盘")]),s._v("、"),e("font",{attrs:{color:"#DD1144"}},[s._v("网卡")]),s._v("这些硬件部分所限制，比如你的服务器的吞吐量大概就是你网卡的带宽（注意单位换算），那么基本上就是网卡限制了你的服务器的性能。")],1),s._v(" "),e("p",[s._v("那基本上我们在"),e("code",[s._v("linux")]),s._v("测试性能，都会现在"),e("code",[s._v("linux")]),s._v("服务器上跑一些命令，然后在外部进行压测")]),s._v(" "),e("ul",[e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("top")]),s._v(": 通过跑"),e("code",[s._v("top")]),s._v("命令来监控"),e("code",[s._v("cpu")]),s._v("和内存使用情况的，在外部压测的同时，可以通过监控的"),e("code",[s._v("cpu")]),s._v("占比和内存占比看到底是哪里限制了服务器")],1),s._v(" "),e("li",[e("font",{attrs:{color:"#DD1144"}},[s._v("iostat")]),s._v("：检测各个I/O设备的带宽，比如硬盘I/O在压测的情况下已经到了极限，那就说明服务器可以处理的过来，但是硬盘已经跟不上了，这就是I/O瓶颈")],1)]),s._v(" "),e("p",[s._v("但是基本上在服务器确定的情况下，我们大部分问题其实都是我们自己书写的"),e("code",[s._v("Node-BFF")]),s._v("层，而且就在"),e("font",{attrs:{color:"#DD1144"}},[s._v("node-bff层中的cpu运算上")]),s._v("，比说大面积的字符串拼接等js运算，就体现在程序运行的时候"),e("code",[s._v("cpu")]),s._v("的占用率是"),e("code",[s._v("100%")])],1),s._v(" "),e("p",[s._v("当然还有负载，在负载到达极限的时候，如果是我们"),e("code",[s._v("node")]),s._v("计算性能到达了瓶颈，基本上表现在程序当中就是"),e("font",{attrs:{color:"#DD1144"}},[s._v("某一段代码写的不好，导致了大面积出现了问题")])],1),s._v(" "),e("h2",{attrs:{id:"node微观性能检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node微观性能检测"}},[s._v("#")]),s._v(" Node微观性能检测")]),s._v(" "),e("p",[s._v("为了检测具体的"),e("code",[s._v("Node")]),s._v("运行信息，我们现在的压测用具的命令稍做改动：")]),s._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("ab "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c50 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t15 http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_1-profile工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-profile工具"}},[s._v("#")]),s._v(" 1. profile工具")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("node --prof entry.js")]),s._v(" -> 生成"),e("code",[s._v("isolate-00000000003E4090-v8.log")]),s._v("文件（空文件）")]),s._v(" "),e("li",[s._v("执行压测15秒的命令 -> 在"),e("code",[s._v("isolate-00000000003E4090-v8.log")]),s._v("文件中生成了好多内容")]),s._v(" "),e("li",[e("code",[s._v("node --prof-process isolate-00000000003E4090-v8.log > profile.txt")]),s._v("-> 将log文件中的东西进行分析，分析到"),e("code",[s._v("profile.txt")]),s._v("文件当中")])]),s._v(" "),e("p",[s._v("总之呢，这种工具实在是很难看懂，有没有更加简单的工具呢？")]),s._v(" "),e("h3",{attrs:{id:"_2-chrome-devtool"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-chrome-devtool"}},[s._v("#")]),s._v(" 2. Chrome devtool")]),s._v(" "),e("p",[e("font",{attrs:{color:"#1E90FF"}},[e("strong",[s._v("① cpu检测")])])],1),s._v(" "),e("ul",[e("li",[e("code",[s._v("node --inspect-brk entry.js")]),s._v(" -> 启动程序的时候就一开始就暂停，进去后再开始")]),s._v(" "),e("li",[s._v("打开"),e("code",[s._v("chrome://inspect")]),s._v(",点击最下面的"),e("code",[s._v("Target")]),s._v("进入调试，点击开始按钮即可")]),s._v(" "),e("li",[s._v("上面有两个"),e("code",[s._v("Tab")]),s._v("，一个是"),e("code",[s._v("Memory")]),s._v(",一个是"),e("code",[s._v("Profiler")]),s._v("，分别表示的内存和"),e("code",[s._v("cpu")]),s._v("的检测")]),s._v(" "),e("li",[s._v("我们在"),e("code",[s._v("Profiler")]),s._v("当中点击"),e("code",[s._v("Start CPU profiling")]),s._v("按钮")]),s._v(" "),e("li",[s._v("然后开始15秒的压测，"),e("code",[s._v("ab -c50 -t15 http://localhost:3000/download/")])]),s._v(" "),e("li",[s._v("然后回到"),e("code",[s._v("Profiler")]),s._v("的当中点击"),e("code",[s._v("stop")]),s._v("的按钮，就能根据从上到下的耗时去优化")])]),s._v(" "),e("p",[e("font",{attrs:{color:"#1E90FF"}},[e("strong",[s._v("② 内存检测")])])],1),s._v(" "),e("ul",[e("li",[e("code",[s._v("node --inspect-brk entry.js")]),s._v(" -> 启动程序的时候就一开始就暂停，进去后再开始")]),s._v(" "),e("li",[s._v("打开"),e("code",[s._v("chrome://inspect")]),s._v(",点击最下面的"),e("code",[s._v("Target")]),s._v("进入调试，点击开始按钮即可")]),s._v(" "),e("li",[s._v("上面有两个"),e("code",[s._v("Tab")]),s._v("，一个是"),e("code",[s._v("Memory")]),s._v(",一个是"),e("code",[s._v("Profiler")]),s._v("，分别表示的内存和"),e("code",[s._v("cpu")]),s._v("的检测")]),s._v(" "),e("li",[s._v("然后开始15秒的压测，"),e("code",[s._v("ab -c50 -t15 http://localhost:3000/download/")])]),s._v(" "),e("li",[s._v("在压测的过程中，在"),e("code",[s._v("Memory")]),s._v("当中点击"),e("code",[s._v("Take heap snaphot")]),s._v(",生成内存快照")]),s._v(" "),e("li",[s._v("等待压测结束，在"),e("code",[s._v("Memory")]),s._v("当中再次点击"),e("code",[s._v("Take heap snaphot")]),s._v("，生成内存快照")]),s._v(" "),e("li",[s._v("然后点击"),e("code",[s._v("Comparison")]),s._v("来对比两次快照的变化，通过观察"),e("code",[s._v("Alloc.Size")]),s._v("和"),e("code",[s._v("Freed.Size")]),s._v("的差值看到"),e("code",[s._v("Size Delta")]),s._v("，观察内存是否存在泄露")]),s._v(" "),e("li",[s._v("一般在"),e("code",[s._v("snaphot1")]),s._v("和"),e("code",[s._v("snaphot2")]),s._v("之前大小比较十分悬殊的情况下，是一定存在内存泄漏的。")])]),s._v(" "),e("h3",{attrs:{id:"_3-clinic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-clinic"}},[s._v("#")]),s._v(" 3. clinic")]),s._v(" "),e("p",[s._v("针对比较大的项目，我们可以使用"),e("code",[s._v("clinic")]),s._v("，具体的用法建议你到npm上去学习和使用，这里就不具体解释了")])])}),[],!1,null,null,null);t.default=n.exports}}]);